<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>楼市</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<style>
			.list-title {
				margin: 20px 15px 10px;
				color: #3d3d3d;
				font-size: 15px;
			}
			
			.mui-table-view .mui-media-object {
				line-height: 75px;
				max-width: 100px;
				height: 75px;
			}
		</style>
	</head>

	<body>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<!-- Slider -->
			<div id="slider" class="mui-slider">
				<div class="mui-slider-group mui-slider-loop">
					<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="../images/yuantiao.jpg">
						</a>
					</div>
					<!-- 第一张 -->
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/shuijiao.jpg">
						</a>
					</div>
					<!-- 第二张 -->
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/muwu.jpg">
						</a>
					</div>
					<!-- 第三张 -->
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/cbd.jpg">
						</a>
					</div>
					<!-- 第四张 -->
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/yuantiao.jpg">
						</a>
					</div>
					<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="../images/shuijiao.jpg">
						</a>
					</div>
				</div>
				<div class="mui-slider-indicator">
					<div class="mui-indicator mui-active"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
				</div>
			</div>
			<div class="mui-scroll">
				<!-- List -->
				<h4 class="list-title">楼盘</h4>
				<ul id="myList" class="mui-table-view">
				</ul>
			</div>
		</div>
	</body>

	<script src="../js/mui.min.js"></script>
	<script src="../js/app.js"></script>
	<script src="../js/app.template.js"></script>
	<script type="text/javascript" charset="utf-8">
		(function(mui, doc) {
			//mui初始化
			mui.init({
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						contentrefresh: '正在加载...',
						callback: pulldownRefresh
					},
					up: {
						contentrefresh: '正在加载...',
						callback: pullupLoad
					}
				}
			});
			mui.plusReady(function() {
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});
				app.initTemplates();
			});
			// 在刚方法内添加页面第一次被打开时需要执行的方法
			app.initPage = function() {
				var slider = mui("#slider");
				slider.slider({
					interval: 5000
				});
				// 触发下拉加载时间
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				}, 0);
			};
			var count = 0;
			var myList = document.getElementById('myList');
			var page = 0;
			//下拉，相当于初始化
			function pulldownRefresh() {
				page = 0;
				myList.innerHTML="";
				pullupLoad();
			}
			//往上推，加载更多数据
			function pullupLoad() {
				// 初始化数据
				mui.ajax(app.conf.host + "/api/properties.json", {
					dataType: 'json', //服务器返回json格式数据
					type: 'get', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；
					data:{"page":++page,"rows":10},
					success: function(data, textStatus, xhr) {
						//服务器返回响应，根据响应结果，分析是否登录成功；
						if (data) {
							myList.innerHTML = myList.innerHTML + data.html;
						} else {
							myList.innerHTML = myList.innerHTML + "加载数据失败了";
						}
						mui('#pullrefresh').pullRefresh().endPullupToRefresh(data.total <= page*10); //参数为true代表没有更多数据了。
					}
				});
			}
			//主列表点击事件
			mui('#myList').on('tap', 'a', function() {
				var conf = {};
				conf.id = this.getAttribute('href');
				conf.href = this.href;
				//判断是否显示右上角menu图标；
				conf.showMenu = false;
				var h4el = this.getElementsByTagName("h4");
				if (h4el && h4el.length > 0) {
					conf.title = h4el[0].innerText.trim();
				} else {
					conf.title = this.innerText.trim();
				}
				app.toDatail(conf);
			});
			//主列表点击事件
		}(mui, document));
	</script>

</html>