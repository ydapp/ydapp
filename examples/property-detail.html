<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>楼盘详情</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<style type="text/css">
			.pis-bar {
				position: fixed;
				z-index: 10;
				right: 0;
				left: 0;
				height: 44px;
				padding: 6px;
				padding-right: 10px;
				padding-left: 10px;
				border-bottom: 0;
				background-color: #f7f7f7;
				-webkit-box-shadow: 0 0 1px rgba(0, 0, 0, .85);
				box-shadow: 0 0 1px rgba(0, 0, 0, .85);
				-webkit-backface-visibility: hidden;
				backface-visibility: hidden;
			}
			
			.table-label {
				text-align: left;
				vertical-align: top;
				width: 85px;
			}
			
			.mui-segmented-control .mui-control-item {
				line-height: 50px;
				width: 100%;
			}
			
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				background-color: #fff;
			}
			
			#segmentedControlContents {
				padding: 0 5px 5px 5px;
			}
		</style>
	</head>

	<body>
		<footer class="pis-bar mui-bar-footer" style="text-align: center;">
			<div class="mui-row">
				<div class="mui-col-xs-4">
					<a type="button" id="id_propertyTel" style="background-color: #37ADB0;border:0px;" class="mui-btn mui-btn-primary" href="tel:88888888">
						<span class="mui-icon mui-icon-phone" ></span>案场电话
					</a>
				</div>
				<div class="mui-col-xs-4">
					<button type="button" id="goSubscriptionRules" style="background-color: #37ADB0;border:0px;"  class="mui-btn mui-btn-danger" title="">
						<span class="mui-icon mui-icon-compose"></span>游戏规则
					</button>
				</div>
				<div class="mui-col-xs-4">
					<button type="button" id="goRecommend" style="background-color: #E48714;border:0px;" class="mui-btn mui-btn-primary">
						<span class="mui-icon mui-icon-compose"></span>立刻推荐
					</button>
				</div>
			</div>
		</footer>
		<div class="mui-content" style="background-color: #FFFFFF;">
			<img id="id_filePath" src="../images/cbd.jpg" style="width:100%;padding:5px;height:40%;" />

			<div class="mui-row">
				<div class="mui-col-xs-9" style="padding-left: 5px;">
					<div style="padding-top: 6px;"><strong class="mui-h3" id="header_id_propertyName" >楼盘名称</strong> <font style="color:darkgray;">[<span id="header_id_cityTitle" ></span>]</font></div>
					<div style="padding-top: 10px;color:#E48714;">均价：<span id="header_id_avgPrice" ></span>元/㎡</div>
				</div>
				<div class="mui-col-xs-3">
					<div class="am-text-lg">已推荐</div>
					<div id="header_id_recommendedNumber" style="color:#E48714;font-size:20px;" ></div>
					<div class="am-text-lg">已预约</div>
					<div id="header_id_viewTimes" style="color:#E48714;font-size:20px;"></div>
				</div>
			</div>
			<hr data-am-widget="divider" style="" class="am-divider am-divider-dotted" />
			<div class="mui-row">
				<div id="segmentedControlContents" class="mui-col-xs-9">
					<div id="content1" class="mui-control-content mui-active">
						<table>
							<tr>
								<td class="table-label">首期开盘：</td>
								<td id="id_openDate"></td>
							</tr>
							<tr>
								<td class="table-label">楼盘特色：</td>
								<td id="id_characteristic"></td>
							</tr>
							<tr>
								<td class="table-label">装修类型：</td>
								<td id="id_propertyType">毛坯</td>
							</tr>
							<tr>
								<td class="table-label">占地面积：</td>
								<td id="id_area">约9万平方米</td>
							</tr>
							<tr>
								<td class="table-label">产权：</td>
								<td ><span id="id_year"></span>年</td>
							</tr>
							<tr>
								<td class="table-label">绿化率：</td>
								<td><span id="id_greenRate"></span>%</td>
							</tr>
							<tr>
								<td class="table-label">物业公司：</td>
								<td id="id_propertyCompany"></td>
							</tr>
							<tr>
								<td class="table-label">交付时间：</td>
								<td id="id_deliveryTime">2015-10</td>
							</tr>
						</table>
					</div>
					<div id="content2" class="mui-control-content">
						<table>
							<tr>
								<td class="table-label">公交线路：</td>
								<td>805、15、35路在牛首山站下</td>
							</tr>
							<tr>
								<td class="table-label">地铁线路：</td>
								<td>地铁一号线 牛首山站下</td>
							</tr>
							<tr>
								<td class="table-label">开车自驾：</td>
								<td>绕城高速在牛首山出口下即可、宁溧路与丹阳路交叉口</td>
							</tr>
						</table>
					</div>
					<div id="content3" class="mui-control-content">
						<table>
							<tr>
								<td class="table-label">4室2厅2卫 160平方</td>
								<td><img width="200" height="200" src="http://images2.jiwu.com/housepic1/40/18206/245399_m.jpg"></img>
								</td>
							</tr>
							<tr>
								<td class="table-label">3室2厅1卫 120平方</td>
								<td><img width="200" height="200" src="http://imgs.jiwu.com/attachment/housepic/2011/06/26/757489_m.jpg"></img>
								</td>
							</tr>
							<tr>
								<td class="table-label">2室2厅1卫 95平方</td>
								<td><img width="200" height="200" src="http://imgs.jiwu.com/attachment/housepic/2011/06/26/757484_m.jpg"></img>
								</td>
							</tr>
						</table>
					</div>
				</div>
				<div class="mui-col-xs-3" style="border-left: 1px solid #c8c7cc;">
					<div id="segmentedControls" class="mui-segmented-control mui-segmented-control-inverted mui-segmented-control-vertical">
						<a class="mui-control-item mui-active" id="content1_a" style="" href="#content1">楼盘介绍</a>
						<a class="mui-control-item" id="content2_a" href="#content2">交通配套</a>
						<a class="mui-control-item" id="content3_a" href="#content3">户型介绍</a>
					</div>
				</div>
			</div>
		</div>
		<!--用于有多个案场和专员时候使用的选择弹出框 -->
		<div id="commissionerTelPopover" class="mui-popover">
			<ul class="mui-table-view" id="commissionerTelPopoverUL">
			</ul>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/app.js"></script>
		<script src="../js/feedback-page.js"></script>
		<script src="../js/template.js"></script>
		<script id="tmpl_trafficFacilities" type="text/html">
			{{each rows}}
			<table>
				<tr><td class="table-label">{{$value.name}}:</td><td>{{$value.value}}</td></tr>
			</table>
			{{/each}}
		</script>
		<script id="tmpl_houseType" type="text/html">
			{{each rows}}
			<table>
				<tr><td class="table-label">{{$value.name}}:</td><td>
					<img width="200" height="200" src="{{$value.value}}"></img>
					</td></tr>
			</table>
			{{/each}}
		</script>
		<script type="text/javascript" charset="utf-8">
			
			(function(mui, doc) {
				//推荐页面
		    	var wp = null;
		    	//楼盘数据对象;
		    	var building = null;
				var ws = null;
				// 动画窗口
				function animateWindow() {
					console.log("打开推荐窗口之前初始化楼盘数据");
					try {
						console.log("调用初始化building方法");
						console.log("wp:" + wp);
						console.log("building:" + building);
						mui.fire(wp,'initBuilding',building);
					} catch (e){
						console.error("发生错误", e);
						alert(e);
					}
					wp.show('slide-in-bottom');
					wp.evalJS('app.exceptFirst()');
				}
				//mui初始化
				mui.init();
				mui.plusReady(function() {
					plus.webview.currentWebview().setStyle({
						scrollIndicator: 'none'
					});
					// 预加载推荐页面
					wp = mui.preload({
						url: 'tab-recommend.html',
						id: 'recommend',
						styles: {
							scrollIndicator: 'none',
							scalable: false,
							popGesture: 'none'
						},
						extras: {
							mType: 'pop'
						}
					});
				});
				document.getElementById("goRecommend").addEventListener('tap', function(e) {
					e.stopPropagation();
					animateWindow();
				});
				document.getElementById("goSubscriptionRules").addEventListener('tap', function(e) {
					alert(this.title);
				});
				var content1_obj = document.getElementById("content1_a");
				var content2_obj = document.getElementById("content2_a");
				var content3_obj = document.getElementById("content3_a");
				document.getElementById("content1_a").addEventListener('tap',function(e){
					this.innerHTML='<img src="../images/1.png" width="80px;" height="45px;" style="margin:0 auto;"/>';
					this.style.paddingTop="10px";
					content2_obj.innerHTML="交通配套";
					content3_obj.innerHTML="户型介绍";
				});
				document.getElementById("content2_a").addEventListener('tap',function(e){
					this.innerHTML='<img src="../images/2.png" width="80px;" height="45px;"style="margin:0 auto;"/>';
					this.style.paddingTop="10px";
					content1_obj.innerHTML="楼盘介绍";
					content3_obj.innerHTML="户型介绍";
				});
				document.getElementById("content3_a").addEventListener('tap',function(e){
					this.innerHTML='<img src="../images/3.png" width="80px;" height="45px;"style="margin:0 auto;"/>';
					this.style.paddingTop="10px";
					content1_obj.innerHTML="楼盘介绍";
					content2_obj.innerHTML="交通配套";
				});
				// 获得请求页面时携带的参数
				var params = {};
				(function() {
					var qs = location.search.substring(1, location.search.length);
					if (qs.length == 0) {
						return;
					}
					qs = qs.replace(/\+/g, ' ');
					var args = qs.split('&');
					for (var i = 0; i < args.length; i++) {
						var pair = args[i].split('=');
						var name = decodeURIComponent(pair[0]);
						var value = (pair.length == 2) ? decodeURIComponent(pair[1]) : name;
						console.log("name:" + name + " value:" + value);
						params[name] = value;
					}
				})();
				content1_obj.innerHTML='<img src="../images/1.png" width="80px;" height="45px;" style="margin:0 auto;"/>';
				content1_obj.style.paddingTop="10px";
				// 获得页面宽度
				params.viewWidth = document.body.clientWidth;
				mui.ajax(app.conf.host + "/api/property/" + params.index + ".json", {
					data: params,
					dataType: 'json', //服务器返回json格式数据
					type: 'get', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；
					success: function(data, textStatus, xhr) {
						//服务器返回响应，根据响应结果，分析是否登录成功；
						console.log("data:" + data);
						console.log("data.building:" + data.building);
						building = data.building;
						console.log("楼盘名称:" + building.propertyName);
						console.log("city:" + building.city);
						console.log("cityTitle:" + building.cityTitle);
						if (building) {
							console.log("楼盘信息:" + JSON.stringify(building));
							document.getElementById("id_filePath").src=building.filePath;
							document.getElementById("goSubscriptionRules").title=building.subscriptionRules;
							//电话格式如下“姓名:电话”有多个时候用分号隔开“案场:123;张三:456”
							console.log("tel:" + building.propertyTel);
							//默认显示案场本身电话
							var tels = building.propertyTel.split(";");
							if (tels.length == 1){
								var telObj = tels[0].split(":");
								document.getElementById("id_propertyTel").href="tel:" + telObj[1];
							} else {
								document.getElementById("id_propertyTel").href="#commissionerTelPopover";
								var liString = "";
								for (var i = 0; i < tels.length; i++){
									var telObj = tels[i].split(":");
									liString += "<li class=\"mui-table-view-cell\"><a href=\"tel:" + telObj[1] + "\">" + telObj[0] + "(" + telObj[1] + ")</a></li>";
								}
								console.log("liString:" + liString);
								document.getElementById("commissionerTelPopoverUL").innerHTML=liString;
							}
							//如果只有一个电话，则直接拨号，如果有多个电话则使用列表选择的模式
							
							
							
							document.getElementById("header_id_propertyName").innerHTML = building.propertyName;
							document.getElementById("header_id_cityTitle").innerHTML = building.cityTitle+"•"+building.address.substring(0,5);
							document.getElementById("header_id_avgPrice").innerHTML = building.avgPrice ? building.avgPrice : "";
							document.getElementById("header_id_recommendedNumber").innerHTML = building.recommendedNumber ? building.recommendedNumber : 0 ;
							document.getElementById("header_id_viewTimes").innerHTML = building.viewTimes ? building.viewTimes : 0;
							
							document.getElementById("id_openDate").innerHTML = building.openDate ? building.openDate.substring(0, 10) : "";
							document.getElementById("id_characteristic").innerHTML = building.characteristic ? building.characteristic : "";
							document.getElementById("id_propertyType").innerHTML = building.propertyType ? building.propertyType : "";
							document.getElementById("id_area").innerHTML = building.area ? building.area : "";
							document.getElementById("id_greenRate").innerHTML = building.greenRate ? building.greenRate : "";
							document.getElementById("id_year").innerHTML = building.years ? building.years : "";
							document.getElementById("id_propertyCompany").innerHTML = building.propertyCompany ? building.propertyCompany : "";
							document.getElementById("id_deliveryTime").innerHTML = building.deliveryTime ? building.deliveryTime.substring(0, 10) : "";
							var trafficFacilities = building.trafficFacilities;
							var rows = new Array();
							if (trafficFacilities){
								var lines = trafficFacilities.split("***");
								for (var i = 1; i < lines.length;i++){
									var trafficFacilitiesKV = lines[i].split(":::");
									var trafficFacilitiesJson = {"name":trafficFacilitiesKV[0],"value":trafficFacilitiesKV[1]};
									rows[i-1] = trafficFacilitiesJson;
								}
							}
							var trafficFacilitiesData = {"rows":rows};
							console.log("trafficFacilitiesDataJSOn:" + JSON.stringify(trafficFacilitiesData));
							var trafficFacilitiesHTML = template('tmpl_trafficFacilities', trafficFacilitiesData);
							console.log("trafficFacilitiesHTML:" + trafficFacilitiesHTML);
							document.getElementById("content2").innerHTML = trafficFacilitiesHTML;
							
							var houseType = building.houseType;
							rows = new Array();
							if (houseType){
								var lines = houseType.split("***");
								for (var i = 1; i < lines.length;i++){
									var houseTypeKV = lines[i].split(":::");
									var houseTypeJson = {"name":houseTypeKV[0],"value":app.conf.host+"/"+houseTypeKV[1]};
									rows[i-1] = houseTypeJson;
								}
							}
							var houseTypeData = {"rows":rows};
							console.log("houseTypeDataJSOn:" + JSON.stringify(houseTypeData));
							var houseTypeHTML = template('tmpl_houseType', houseTypeData);
							console.log("houseTypeHTML:" + houseTypeHTML);
							document.getElementById("content3").innerHTML = houseTypeHTML;
						}
						
					},
					error:function(xhr, type, errorThrown){
						console.log("发生错误:" + type);
						console.log("errorThrown:" + errorThrown);
						console.log("xhr");
						console.log("responseText:" + xhr.responseText);
						
					}
				});
			}(mui, document));
		</script>
	</body>

</html>